version: '2'
services:
  unbound:
    build: ./unbound
    ports:
    - "53:53/udp"
    depends_on:
    - fluentd
    logging:
      driver: fluentd
      options:
        fluentd-address: localhost:24224
  kea:
    build: ./kea
    network_mode: host
    env_file:
    - ./mysql.env
    depends_on:
    - fluentd
    logging:
      driver: fluentd
      options:
        fluentd-address: localhost:24224
  kea-db:
    build: ./kea-db
    restart: always    
    ports:
    - 3306:3306
    env_file:
    - ./mysql.env
    volumes:
    - kea-db-vol:/var/lib/mysql
    depends_on:
    - fluentd
    logging:
      driver: fluentd
      options:
        fluentd-address: localhost:24224
  fluentd:
    build: ./fluentd
    ports:
    - "24224:24224"
    volumes:
    - fluentd-buffer:/var/log/fluentd
volumes:
  kea-db-vol:
  fluentd-buffer:
